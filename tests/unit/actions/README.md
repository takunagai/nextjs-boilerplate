# サーバーアクションテスト

このディレクトリには、Next.jsのサーバーアクションに対するユニットテストが含まれています。

## テスト対象

1. **フォームサンプル用サーバーアクション** (`form-example.test.ts`)
   - `submitExampleForm`: サンプルフォームの送信処理
   - `checkExampleEmail`: メールアドレスの存在確認

2. **お問い合わせフォーム用サーバーアクション** (`contact-form.test.ts`)
   - `submitContactForm`: お問い合わせフォームの送信処理
   - `checkEmailExists`: メールアドレスの存在確認

## テスト手法

### モック化

以下の要素をモック化してテストを実行しています：

- `validateAction`: 入力データのバリデーション関数
- `console.log`/`console.error`: コンソール出力
- `setTimeout`: 非同期処理の遅延

### テストケース

各サーバーアクションに対して、以下のテストケースを実装しています：

1. **正常系**
   - 有効なデータが送信された場合の成功レスポンス

2. **異常系**
   - バリデーションエラーが発生した場合のエラーレスポンス
   - 予期しないエラーが発生した場合の汎用エラーレスポンス
   - 無効なメールアドレスの場合のエラーレスポンス

## テスト実行方法

```bash
# すべてのテストを実行
npm test

# 特定のテストファイルのみ実行
npm test -- tests/unit/actions/form-example.test.ts
npm test -- tests/unit/actions/contact-form.test.ts
```

## テスト設計のポイント

1. **非同期処理の扱い**
   - サーバーアクション内の非同期処理（`setTimeout`など）をモック化して、テストの実行時間を短縮

2. **エラーハンドリングの検証**
   - `safeAction`によるエラーハンドリングが正しく機能しているか検証
   - 様々なエラーパターンに対する適切なレスポンスの確認

3. **バリデーションの検証**
   - 入力データのバリデーションが正しく行われているか検証
   - バリデーションエラー時の適切なエラーメッセージの確認

4. **型安全性の確保**
   - TypeScriptの型システムを活用して、テストコードの型安全性を確保
